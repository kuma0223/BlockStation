<!DOCTYPE html>
<html lang="ja">
<head>

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="noindex" />

    <script src="setting.js" type="text/javascript"></script>
    <script src="common.js" type="text/javascript"></script>
    <script src="dataio.js" type="text/javascript"></script>

    <script src="jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="jquery.qrcode.min.js" type="text/javascript"></script>

    <link href="style.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        body {
            background: #e8ecef;
        }

        .rec {
            cursor: default;
        }

            .rec:hover {
                background: skyblue;
                color: white;
            }
    </style>
</head>

<body>
    <h2 style="margin: 10px; color: dimgray">タグ設定</h2>

    <div style="display:flex; flex-direction: row">
        <div id="recBox" style="display:flex; flex-direction:column; width: 200px; margin-left: 10px; background: white; border-radius: 3px; padding: 5px;">
        </div>

        <div style="display:flex; flex-direction: column; margin-left:10px; padding: 10px; background: whitesmoke; border-radius: 3px;">
            <div style="display:flex; flex-direction:row">
                <div>
                    <div>No</div>
                    <div style="display: flex; align-items: center">
                        <input id="InputNo" type="text" style="width: 100px" />
                        <div id="InputColor" style="margin-left:10px; width: 20px; height: 20px; background: #c0c6c9" tag="#c0c6c9"></div>
                        <div style="margin-left:10px; width: 10px; height: 20px; background: #c0c6c9" onclick="SetColor('#c0c6c9')"></div>
                        <div style="margin-left:00px; width: 10px; height: 20px; background: #e9546b" onclick="SetColor('#e9546b')"></div>
                        <div style="margin-left:00px; width: 10px; height: 20px; background: #68be8d" onclick="SetColor('#68be8d')"></div>
                        <div style="margin-left:00px; width: 10px; height: 20px; background: #ffd900" onclick="SetColor('#ffd900')"></div>
                        <div style="margin-left:00px; width: 10px; height: 20px; background: #2ca9e1" onclick="SetColor('#2ca9e1')"></div>
                        <div style="margin-left:00px; width: 10px; height: 20px; background: #674196" onclick="SetColor('#674196')"></div>
                    </div>

                    <div style="margin-top: 10px">Object Name</div>
                    <input id="InputName" type="text" style="width: 200px" />
                </div>
                <div style="display:flex; align-items: center; justify-content:center; width: 200px; margin-left: 10px;">
                    <div id="QRCode" style="width:100px; height: 100px; background: black"></div>
                </div>
            </div>
            <div style="display:flex; flex-direction:row; margin-top: 10px">
                <div>
                    <div>Tag text1</div>
                    <textarea id="InputText1" style="height: 200px; width: 200px; padding:3px;"></textarea>
                </div>
                <div style="margin-left: 10px;">
                    <div>Tag text2</div>
                    <textarea id="InputText2" style="height: 200px; width: 200px; padding:3px;"></textarea>
                </div>
            </div>
            <input type="button" value="Set" onclick="PostClick()" style="width: 80px; margin-top: 10px;" />
        </div>
    </div>

	<footer></footer>

	<!-- ◆━━━━━━━━━━━━━━━━━━━━━━━━━━━━◆ -->
    
    <script type="text/javascript">
        window.addEventListener("load", function () {
            getList();
        });
        
        function getList() {
            dataio.getList(callback);

            function callback(data, message) {
                if (data != null) {
                    var box = document.getElementById("recBox");
                    var str = "";
                    data.forEach(function (item) {
                        str += "<div class='rec' onclick=recClick('" + item + "')>" + item + "</div>";
                    });
                    box.innerHTML = str;
                } else {
                    dialog.messagebox("データを取得できませんでした。", dialog.Messagebox_Buttons_Ok, null);
                }
            }
        }

        function recClick(code) {
            var param = {
                type: "GET",
                url: "../api/ArValue/getItem/" + code,
                authorization: account.getToken(),
                callback: callback
            }
            common.ajax.ajax(param)

            function callback(event) {
                var res = JSON.parse(event.response);
                document.getElementById("InputNo").value = res["No"];
                document.getElementById("InputName").value = res["Name"];
                document.getElementById("InputText1").value = res["Text1"];
                document.getElementById("InputText2").value = res["Text2"];
                //document.getElementById("InputColor").style.background = "#" + res["Color"];
                SetColor("#" + res["Color"]);

                $('#QRCode').html('');
                $('#QRCode').qrcode({
                    width: 100, height: 100,
                    text: res["Code"],
                });
            }
        }

        function PostClick() {
            var d = {};
            d['No'] = document.getElementById("InputNo").value;
            d['Name'] = document.getElementById("InputName").value;
            d['Color'] = document.getElementById("InputColor").getAttribute("tag");
            d['Text1'] = document.getElementById("InputText1").value;
            d['Text2'] = document.getElementById("InputText2").value;

            var param = {
                type: "POST",
                url: "../api/ArValue/putItem",
                authorization: account.getToken(),
                data: d
            }
            common.ajax.ajax(param)
        }

        function SetColor(colstr) {
            var tag = document.getElementById("InputColor");
            tag.style.background = colstr;
            tag.setAttribute("tag", colstr.replace(/#/, ""));
        }
	</script>
</body>

</html>
